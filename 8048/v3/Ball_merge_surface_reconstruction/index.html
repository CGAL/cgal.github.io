<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="canonical" href="https://doc.cgal.org/latest/Ball_merge_surface_reconstruction/index.html"/>

<link rel="icon" type="image/png" href="../Manual/g-196x196-doc.png">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=11">
<meta name="generator" content="Doxygen 1.9.6">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CGAL 6.1 - Ball Merge Surface Reconstruction: User Manual</title>
<!-- <link href="../Manual/tabs.css" rel="stylesheet" type="text/css"/> -->
<script type="text/javascript" src="../Manual/jquery.js"></script>
<script type="text/javascript" src="../Manual/dynsections.js"></script>
<script src="../Manual/hacks.js" type="text/javascript"></script>
<!-- Manually include treeview and search to avoid bloat and to fix
     paths to the directory Manual . -->
<!-- $.treeview -->
<!-- $.search -->
<link href="navtree.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="../Manual/resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../Manual/search/search.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="../Manual/search/searchdata.js"></script>
<script type="text/javascript" src="../Manual/search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../Manual/search/search.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="../Manual/search/search.js"></script>
<!-- Manually done below. -->
<link href="../Manual/doxygen.css" rel="stylesheet" type="text/css">
<link href="../Manual/cgal_stylesheet.css" rel="stylesheet" type="text/css">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
//<![CDATA[
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          qprel: [ "{\\gtreqless}", 0],
          qpx: [ "{\\mathbf{x}}", 0],
          qpl: [ "{\\mathbf{l}}", 0],
          qpu: [ "{\\mathbf{u}}", 0],
          qpc: [ "{\\mathbf{c}}", 0],
          qpb: [ "{\\mathbf{b}}", 0],
          qpy: [ "{\\mathbf{y}}", 0],
          qpw: [ "{\\mathbf{w}}", 0],
          qplambda: [ "{\\mathbf{\\lambda}}", 0],
          ssWpoint: [ "{\\bf #1}", 1],
          ssWeight: [ "{w_{#1}}", 1],
          dabs: [ "{\\parallel\\! #1 \\!\\parallel}", 1],
          E: [ "{\\mathrm{E}}", 0],
          A: [ "{\\mathrm{A}}", 0],
          R: [ "{\\mathrm{R}}", 0],
          N: [ "{\\mathrm{N}}", 0],
          Q: [ "{\\mathrm{Q}}", 0],
          Z: [ "{\\mathrm{Z}}", 0],
          ccSum: [ "{\\sum_{#1}^{#2}{#3}}", 3],
          ccProd: [ "{\\prod_{#1}^{#2}{#3}}", 3],
          pyr: [ "{\\operatorname{Pyr}}", 0],
          aff: [ "{\\operatorname{aff}}", 0],
          Ac: [ "{\\cal A}", 0],
          Sc: [ "{\\cal S}", 0],
      },
      equationNumbers: { autoNumber: "AMS" }
  }
}
);
MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
  var PARSE = MathJax.InputJax.TeX.Parse,
      TEXT = PARSE.prototype.InternalText;
  PARSE.Augment({
    InternalText: function (text,def) {
      text = text.replace(/\\/g,"");
      return TEXT.call(this,text,def);
    }
  });
});
//]]>
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<script src="modules.js" type="text/javascript"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="back-nav">
  <ul>
    <li><a href="https://www.cgal.org/">cgal.org</a></li>
    <li><a href="../Manual/index.html">Top</a></li>
    <li><a href="../Manual/general_intro.html">Getting Started</a></li>
    <li><a href="../Manual/tutorials.html">Tutorials</a></li>
    <li><a href="../Manual/packages.html">Package Overview</a></li>
    <li><a href="../Manual/how_to_cite_cgal.html">Acknowledging CGAL</a></li>
  </ul>
  <!-- In a package SEARCHENGINE = false, so we cannot use 
       insertion. That's why we have to do it manually here. Notice
       that we also take pngs from the Manual. -->
  <div id="MSearchBox" class="MSearchBoxInactive">
      <span class="left">
         <span id="MSearchSelect" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()">Â 
        </span>
        <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
      </span>
      <span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../Manual/search/close.svg" alt=""></a>
      </span>
  </div>
</div>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CGAL 6.1 - Ball Merge Surface Reconstruction
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Code below is usually inserted by doxygen when SEARCHENGINE =
     true. Notice that the path to the search directory is adjusted to
     the top-level.-->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../Manual/search/",'.html');
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>
<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync" style="display: none"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">User Manual </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="Chapter_Ball_merge_surface_reconstruction"></a> </p> <div id="autotoc" class="toc"></div>  <dl class="section author"><dt>Author</dt><dd>Amal Dev Parakkat, Stefan Ohrhallinger, Elmar Eisemann, Pooran Memari</dd></dl>
<p>This CGAL component implements a surface reconstruction method that takes an unoriented set of 3D points as input and computes a piecewise linear approximation of the sampled surface. In simple words, the method tries to classify the medial balls (computed from the 3D Delaunay triangulation of the input points) into interior and exterior and returns the interface between them.</p>
<p>The detailed description of the algorithm can be seen in <a class="el" href="citelist.html#CITEREF_parakkat2024ballmerge">[2]</a>.</p>
<h1><a class="anchor" id="secBMSRdefinitions"></a>
Definitions</h1>
<p>The method is built upon the fact that whenever a discrete set of sample points approximates a continuous surface, the Voronoi balls (interior/exterior) intersect along the boundary with a ratio inversely proportional to the sampling density (similar to the observation of Amenta et al. <a class="el" href="citelist.html#CITEREF_ack-pcubm-01">[1]</a>). Based on this, we define an <em>intersection</em> <em>ratio</em> between adjacent Voronoi balls as follows:</p>
<p>\( ir(B_0,B_1) = max((r_0+r_1-d)/r_0,(r_0+r_1-d)/r_1) \)</p>
<p>Where \( B_0 \) and \( B_1 \) are two adjacent Voronoi balls with radius \( r_0 \) and \( r_1 \) respectively, and \( d \) is the distance between it's circumcenters.</p>
<p>Using this ratio, we can say that if the intersection ratio between two adjacent Voronoi balls is small, they likely correspond to a pair of interior and exterior balls sharing a thin overlapping region along the underlying surface (a 2D case is illustrated in Figure <a class="el" href="index.html#fig__figBMSRillus">Figure 71.1</a>). In other words, given a threshold \( \delta \), a triangle is said to belong to a set \( BallMerge(\delta) \) if its corresponding adjacent Voronoi balls have an intersection ratio less than \( \delta \). By definition, \( BallMerge(\delta) \) is a subcomplex of the Delaunay triangulation of the sample points. It is easy to see that \( BallMerge(0) \) is empty, while \( BallMerge(\delta) \), for any \( \delta \gt 2 \) contains all the triangles of the Delaunay triangulation.</p>
<p><a class="anchor" id="fig__figBMSRillus"></a> </p><div class="image">
<img src="BMSRIllustration.png" alt="">
</div>
   <div class="cgal_figure_caption"> <p>  <a class="el" href="index.html#fig__figBMSRillus">Figure 71.1</a> Top: The interior (red) and exterior (green) medial balls of a point set with decreasing point density from l.t.r. Bottom: Corresponding \( \delta \)-merged components on Delaunay triangulation. </p> </div> <p> <br>
</p>
<p>CGAL provides the global variant of BallMerge as described in <a class="el" href="citelist.html#CITEREF_parakkat2024ballmerge">[2]</a>.</p>
<p><code><a class="el" href="group__PkgBallMergeRef.html#ga9a101f7f2fc022012dab371eae8edc1e" title="creates two watertight meshes approximating the surface, and puts the resulting triangle faces in out...">ball_merge_surface_reconstruction()</a></code>: Given a threshold \( \delta \), two Delaunay simplices are called \( \delta\)-merged either if their corresponding Voronoi balls are adjacent with an intersection ratio \( &gt; \delta \) or if there exists another Delaunay simplex, which is \( \delta\)-merged with both of them. Following a procedure similar to classical connected component computation, the algorithm starts by visiting \( \delta\)-merged simplices from an arbitrary seed simplex (the procedure is order independent) and tag them with the current component label until no more \( \delta\)-merged simplices remain. The procedure is then restarted with any yet unvisited simplex until all have been visited, and output the simplices with the most frequent label. The reconstructed surface is then computed from the boundary of this output.</p>
<h2><a class="anchor" id="secBMSRChoose"></a>
Input Requirements</h2>
<p>This method expects as input a 3D point cloud sampled a manifold close surface with a single connected component. It always returns a watertight and manifold surface triangle mesh. As the algorithm attempts to close the surface, it can tolerate some missing data and can handle little outliers and noise. If there are some significant gaps in the data, the internal flooding algorithm will generate triangle faces from points visible from inside the input surface.</p>
<h2><a class="anchor" id="secBMSRPar"></a>
Parameter Settings</h2>
<p>The main parameter used in \( BallMerge \) is the intersection ratio \(\delta\). By definition, \(\delta\) ranges from 0 to 2, with \( BallMerge(0) \) being empty and \( BallMerge(2) \) containing all the triangles of the Delaunay triangulation. Experiments show that the \( &gt; \delta \) value usually lies between 1.5 and 1.95, with 1.8 or 1.85 yielding the best results in most cases. Thanks to the useful properties of this intersection ratio, tuning this parameter can be done using the following rule: if the reconstructed surface has missing parts, the threshold should be lowered, conversely, if the reconstructed surface has additional parts, the threshold should be increased.</p>
<p>If no value is provided to the reconstruction function, the \(\delta\) parameter is automatically estimated using the following method: Starting from the maximal value 2, we iteratively decrease \(\delta\) until the reconstructed surface undergoes a sudden vertex-count drop (10% of the total number of input points). This indicates that a large number of interior/exterior medial balls have become \(\delta\)-merged, causing that part of the reconstructed surface to collapse. Consequently, the value from the previous iteration is used to generate the output. The \(\delta\) value used is always returned by the functions.</p>
<h1><a class="anchor" id="secBMSRexamples"></a>
Examples</h1>
<p><code><a class="el" href="group__PkgBallMergeRef.html#ga9a101f7f2fc022012dab371eae8edc1e" title="creates two watertight meshes approximating the surface, and puts the resulting triangle faces in out...">ball_merge_surface_reconstruction()</a></code> has the following arguments: The set of input points, two output parameters where the resulting meshes will be stored, and optionally the parameter \( \delta \). The function returns two meshes - the largest and second-largest components as sometimes the expected shape will be the second-largest component after merging. A sample program showing how to use this function is given below, together with the output reconstructions.</p>
<p><a class="anchor" id="fig__figBMSKitten"></a> </p><div class="image">
<img src="kitten_ball_merged.png" alt="">
</div>
   <div class="cgal_figure_caption"> <p>  <a class="el" href="index.html#fig__figBMSKitten">Figure 71.2</a> Results of the run of the ball merge algorithm with automatic delta parameter estimation. From left to right: Input point cloud (no normal required); one of the two output containing the expected triangle mesh; the second output representing the non desired part, that is actually a triangle soup with non-manifold edges (shown in red). The <code>delta</code> parameter that is automatically estimated is <code>1</code>. </p> </div> <p> <br>
</p>
<p><br>
<b>File</b> <a class="el" href="Ball_merge_surface_reconstruction_2ball_merge_reconstruction_8cpp-example.html">Ball_merge_surface_reconstruction/ball_merge_reconstruction.cpp</a> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;CGAL/Exact_predicates_inexact_constructions_kernel.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;CGAL/Ball_merge_surface_reconstruction.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;CGAL/IO/polygon_soup_io.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;CGAL/IO/read_points.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <a class="code hl_classRef" href="../Kernel_23/classCGAL_1_1Exact__predicates__inexact__constructions__kernel.html">CGAL::Exact_predicates_inexact_constructions_kernel</a> K;</div>
<div class="line"><span class="keyword">typedef</span> K::Point_3 Point;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>params=<a class="code hl_namespaceRef" href="../STL_Extension/namespaceCGAL_1_1parameters.html">CGAL::parameters</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// reading input points and parameters</span></div>
<div class="line">  <span class="keyword">const</span> std::string inFilename=argc&gt;1?argv[1]:<a class="code hl_functionRef" href="../Manual/namespaceCGAL.html#acdae9a147ad2a3998cc21f88bc292dac">CGAL::data_file_path</a>(<span class="stringliteral">"points_3/kitten.xyz"</span>);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;Point&gt; points;</div>
<div class="line">  CGAL::IO::read_points(inFilename, std::back_inserter(points));</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (points.empty())</div>
<div class="line">  {</div>
<div class="line">    std::cerr &lt;&lt; inFilename &lt;&lt; <span class="stringliteral">" cannot be read correctly or is empty.\n"</span>;</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//vectors for storing output triangle indices</span></div>
<div class="line">  std::vector&lt;std::array&lt;int,3&gt;&gt; meshFaceIndices1, meshFaceIndices2;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">double</span> delta = argc &gt; 2</div>
<div class="line">    <span class="comment">// run the reconstruction with user passed delta parameter</span></div>
<div class="line">    ? <a class="code hl_function" href="group__PkgBallMergeRef.html#ga9a101f7f2fc022012dab371eae8edc1e">CGAL::ball_merge_surface_reconstruction</a>(points,</div>
<div class="line">                                              meshFaceIndices1, meshFaceIndices2,</div>
<div class="line">                                              params::delta(atof(argv[2]))</div>
<div class="line">                                                     .concurrency_tag(<a class="code hl_structRef" href="../STL_Extension/structCGAL_1_1Parallel__if__available__tag.html">CGAL::Parallel_if_available_tag</a>()))</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// run the reconstruction with automatic parameter estimation</span></div>
<div class="line">    : <a class="code hl_namespaceRef" href="../Manual/namespaceCGAL.html">CGAL</a>::<a class="code hl_function" href="group__PkgBallMergeRef.html#ga9a101f7f2fc022012dab371eae8edc1e">ball_merge_surface_reconstruction</a>(points,</div>
<div class="line">                                              meshFaceIndices1, meshFaceIndices2,</div>
<div class="line">                                              params::concurrency_tag(<a class="code hl_namespaceRef" href="../Manual/namespaceCGAL.html">CGAL</a>::Parallel_if_available_tag()));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// write output triangle soups</span></div>
<div class="line">  <a class="code hl_functionRef" href="../Stream_support/group__IOstreamFunctions.html#ga030115449f48c379b0c080328fd730b0">CGAL::IO::write_polygon_soup</a>(<span class="stringliteral">"BMOut1.ply"</span>, points, meshFaceIndices1); <span class="comment">//The first resulting mesh</span></div>
<div class="line">  <a class="code hl_functionRef" href="../Stream_support/group__IOstreamFunctions.html#ga030115449f48c379b0c080328fd730b0">CGAL::IO::write_polygon_soup</a>(<span class="stringliteral">"BMOut2.ply"</span>, points, meshFaceIndices2); <span class="comment">//The second resulting mesh</span></div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">"delta parameter used = "</span> &lt;&lt; delta &lt;&lt; <span class="stringliteral">"\n"</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassCGAL_1_1Exact__predicates__inexact__constructions__kernel_html"><div class="ttname"><a href="../Kernel_23/classCGAL_1_1Exact__predicates__inexact__constructions__kernel.html">CGAL::Exact_predicates_inexact_constructions_kernel</a></div></div>
<div class="ttc" id="agroup__IOstreamFunctions_html_ga030115449f48c379b0c080328fd730b0"><div class="ttname"><a href="../Stream_support/group__IOstreamFunctions.html#ga030115449f48c379b0c080328fd730b0">CGAL::IO::write_polygon_soup</a></div><div class="ttdeci">bool write_polygon_soup(const std::string &amp;fname, const PointRange &amp;points, const PolygonRange &amp;polygons, const NamedParameters &amp;np=parameters::default_values())</div></div>
<div class="ttc" id="agroup__PkgBallMergeRef_html_ga9a101f7f2fc022012dab371eae8edc1e"><div class="ttname"><a href="group__PkgBallMergeRef.html#ga9a101f7f2fc022012dab371eae8edc1e">CGAL::ball_merge_surface_reconstruction</a></div><div class="ttdeci">double ball_merge_surface_reconstruction(const PointRange &amp;points, TripleIndexRange &amp;out_triangles1, TripleIndexRange &amp;out_triangles2, const NamedParameters &amp;np=parameters::default_values())</div><div class="ttdoc">creates two watertight meshes approximating the surface, and puts the resulting triangle faces in out...</div><div class="ttdef"><b>Definition:</b> Ball_merge_surface_reconstruction.h:586</div></div>
<div class="ttc" id="anamespaceCGAL_1_1parameters_html"><div class="ttname"><a href="../STL_Extension/namespaceCGAL_1_1parameters.html">CGAL::parameters</a></div></div>
<div class="ttc" id="anamespaceCGAL_html"><div class="ttname"><a href="../Manual/namespaceCGAL.html">CGAL</a></div></div>
<div class="ttc" id="anamespaceCGAL_html_acdae9a147ad2a3998cc21f88bc292dac"><div class="ttname"><a href="../Manual/namespaceCGAL.html#acdae9a147ad2a3998cc21f88bc292dac">CGAL::data_file_path</a></div><div class="ttdeci">std::string data_file_path(const std::string &amp;filename)</div></div>
<div class="ttc" id="astructCGAL_1_1Parallel__if__available__tag_html"><div class="ttname"><a href="../STL_Extension/structCGAL_1_1Parallel__if__available__tag.html">CGAL::Parallel_if_available_tag</a></div></div>
</div><!-- fragment --><p>Ideally, the current implementation takes a dense point cloud as input (plain x,y,z coordinates without any additional information like normal or texture) sampled over a smooth surface. Thanks to the "intersection ratio", the algorithm can also handle a few challenging cases with mild noise, outliers or missing data up to an extent. It is worth noting that outliers sometimes create deep cavities over the surface, and an increased amount of noise shrinks and sometimes misses important features.</p>
<p>Finally, the algorithm is efficient, requiring minimal computation resources relative to the input size, as it completes two swift linear-time passes over the 3D Delaunay triangulation.</p>
<h1><a class="anchor" id="secBMSRhistory"></a>
Implementation History</h1>
<p>This package is based on the original code from the research article <a class="el" href="citelist.html#CITEREF_parakkat2024ballmerge">[2]</a> and has been turned into a CGAL package by Amel Dev Parakkat and SÃ©bastien Loriot. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.6-->
<!-- start footer part -->
<!-- The footer div is not part of the default but we require it to
move the footer to the bottom of the page. -->
<div id="footer">
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"></a> 1.9.6 </li>
  </ul>
</div>
</div>
</body>


</html>
